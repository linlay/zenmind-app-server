services:
  backend:
    build:
      context: ./backend
    container_name: app-auth-backend
    environment:
      AUTH_DB_PATH: ${AUTH_DB_PATH:-/data/auth.db}
      AUTH_ISSUER: ${AUTH_ISSUER:-http://localhost:8080}
      AUTH_ADMIN_USERNAME: ${AUTH_ADMIN_USERNAME:-admin}
      AUTH_ADMIN_PASSWORD_BCRYPT: ${AUTH_ADMIN_PASSWORD_BCRYPT:?AUTH_ADMIN_PASSWORD_BCRYPT is required}
      AUTH_APP_USERNAME: ${AUTH_APP_USERNAME:-app}
      AUTH_APP_MASTER_PASSWORD_BCRYPT: ${AUTH_APP_MASTER_PASSWORD_BCRYPT:?AUTH_APP_MASTER_PASSWORD_BCRYPT is required}
      AUTH_APP_ACCESS_TTL: ${AUTH_APP_ACCESS_TTL:-PT10M}
      AUTH_APP_MAX_ACCESS_TTL: ${AUTH_APP_MAX_ACCESS_TTL:-PT12H}
      AUTH_APP_ROTATE_DEVICE_TOKEN: ${AUTH_APP_ROTATE_DEVICE_TOKEN:-true}
      AUTH_APP_INTERNAL_WEBHOOK_SECRET: ${AUTH_APP_INTERNAL_WEBHOOK_SECRET:-change-me}
      AUTH_TOKEN_ACCESS_TTL: ${AUTH_TOKEN_ACCESS_TTL:-PT15M}
      AUTH_TOKEN_REFRESH_TTL: ${AUTH_TOKEN_REFRESH_TTL:-P30D}
      AUTH_TOKEN_ROTATE_REFRESH_TOKEN: ${AUTH_TOKEN_ROTATE_REFRESH_TOKEN:-true}
    volumes:
      - ./data:/data
    ports:
      - "${BACKEND_PORT:-11952}:8080"

  frontend:
    build:
      context: ./frontend
      args:
        VITE_BASE_PATH: ${VITE_BASE_PATH:-/admin/}
        VITE_DEV_PORT: ${VITE_DEV_PORT:-11950}
        VITE_DEV_STRICT_PORT: ${VITE_DEV_STRICT_PORT:-true}
        VITE_API_PROXY_PATH: ${VITE_API_PROXY_PATH:-/admin/api}
        VITE_API_PROXY_TARGET: ${VITE_API_PROXY_TARGET:-http://backend:8080}
    container_name: app-auth-frontend
    depends_on:
      - backend
    volumes:
      - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "${FRONTEND_PORT:-11950}:80"
